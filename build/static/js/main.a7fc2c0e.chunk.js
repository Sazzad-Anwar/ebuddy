(this["webpackJsonpmern-pwa-project-template"]=this["webpackJsonpmern-pwa-project-template"]||[]).push([[0],{492:function(e,t,n){},493:function(e,t,n){},494:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n(22),s=n.n(c),r=n(41),i=n(67),o=n(50),l=n(13),u=n(29),j=n.n(u),d=n(86),h=n(60),m=n(33),b=n(511),p=n(512),f=n(247),O=n(518),x=n(513),g=n(71),v=n.n(g),w=n(521),N=n(520),y=n(252),_=n.n(y),S="USER_LOGIN_REQUEST",L="USER_LOGIN_SUCCESS",k="USER_LOGIN_FAILED",U="USER_LOGOUT",C="USER_UPDATE_SUCCESS",E="USER_UPDATE_FAILED",A=n(2),I=function(){var e=Object(i.useToasts)().addToast,t=Object(r.c)((function(e){return e.userLogin})),n=Object(l.g)(),c=Object(r.b)(),s=Object(a.useState)(""),o=Object(m.a)(s,2),u=o[0],g=o[1],y=Object(a.useState)(""),U=Object(m.a)(y,2),C=U[0],E=U[1],I=Object(a.useState)([]),T=Object(m.a)(I,2),D=T[0],F=T[1],P=function(){var e=Object(h.a)(j.a.mark((function e(t){var n,a,c,s;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.target.files,a=new FormData,c=0;c<n.length;c++)a.append("uploads",n[c]);return e.prev=3,e.next=6,v.a.post("/api/v1/upload",a);case 6:s=e.sent,s.data.map((function(e){return F((function(t){return[].concat(Object(d.a)(t),[e.filePath])}))})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),console.log(e.t0.response);case 14:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=Object(h.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.split("/uploads/")[1],console.log({id:t,uploadId:n}),e.next=4,v.a.delete("/api/v1/upload/".concat(n));case 4:F(D.filter((function(e){return e!==t})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){var e;t&&(null===(e=t.user)||void 0===e?void 0:e.isLoggedIn)&&n.push("/chat")}),[n,t]),Object(A.jsx)("div",{className:"bg-primary",style:{height:"100vh"},children:Object(A.jsxs)(b.a,{className:"pt-5",children:[Object(A.jsx)("h3",{className:"text-white pt-5 text-center",children:"Login To Chat"}),Object(A.jsxs)(p.a,{children:[Object(A.jsx)(f.a,{lg:4}),Object(A.jsx)(f.a,{xs:12,md:12,lg:4,children:Object(A.jsxs)(O.a,{onSubmit:function(t){if(t.preventDefault(),u&&C){var a={name:u,email:C,photo:D[0]};c((s=a,function(){var e=Object(h.a)(j.a.mark((function e(t){var n,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t({type:S}),e.next=4,v.a.post("/api/v1/user",s);case 4:n=e.sent,a=n.data,t({type:L,payload:a.user}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),t({type:k,payload:e.t0.response?e.t0.response:e.t0.message});case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}())),n.push("/chat")}else e("Name or Email can not be null",{autoDismiss:!0,appearance:"error"});var s},className:"my-5",children:[Object(A.jsxs)("div",{className:"d-flex justify-content-center align-items-center position-relative photo",children:[Object(A.jsx)(w.a,{alt:u,src:D[0],style:{height:150,width:150}}),D[0]&&Object(A.jsx)(N.a,{className:"position-absolute delete__icon",onClick:function(){return R(D[0])},children:Object(A.jsx)(_.a,{className:"text-white"})})]}),Object(A.jsxs)(O.a.Group,{className:"mb-3",controlId:"name",children:[Object(A.jsx)(O.a.Label,{className:"text-white",children:"User Name"}),Object(A.jsx)(O.a.Control,{value:u,onChange:function(e){return g(e.target.value)},type:"text",placeholder:"Enter Name",htmlFor:"name"})]}),Object(A.jsxs)(O.a.Group,{className:"mb-3",controlId:"email",children:[Object(A.jsx)(O.a.Label,{className:"text-white",children:"Email address"}),Object(A.jsx)(O.a.Control,{value:C,onChange:function(e){return E(e.target.value)},type:"email",placeholder:"Enter email",htmlFor:"email"})]}),Object(A.jsxs)(O.a.Group,{className:"mb-3",controlId:"photo",children:[Object(A.jsx)(O.a.Label,{className:"text-white",children:"Upload Your Photo"}),Object(A.jsx)("div",{className:"input-group mb-3",children:Object(A.jsx)("input",{type:"file",className:"form-control",accept:"image/*",onChange:P,placeholder:"Input Photos",id:"inputGroupFile02"})})]}),Object(A.jsx)(x.a,{variant:"outline-secondary w-100",type:"submit",children:"Login"})]})}),Object(A.jsx)(f.a,{lg:4})]})]})})},T=function(){return Object(A.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)"},children:Object(A.jsx)("h4",{children:"404 | Page Not Found"})})},D=n(171),F=n(273),P=function(e){var t=e.children,n=Object(F.a)(e,["children"]),a=Object(r.c)((function(e){return e.userLogin})).user;return Object(A.jsx)(l.b,Object(D.a)(Object(D.a)({},n),{},{render:function(e){var n=e.location;return a&&a.isLoggedIn?t:Object(A.jsx)(l.a,{to:{pathname:"/",state:{from:n}}})}}))},R=n(514),W=function(){return Object(A.jsx)(A.Fragment,{children:Object(A.jsx)(R.a,{component:"h1",variant:"h4",style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)"},children:"This is login page"})})},G=n(517),B=n(519),J=n(515),H=n(248),M=n(269),Q=n.n(M),Y=n(522),$=n(516),q=n(88),z=n.n(q),K=n(253),V=n(272),X=n(268),Z=n.n(X),ee=function(){var e=Object(r.c)((function(e){return e.userLogin})).user,t=Object(r.b)(),n=Object(l.g)(),c=Object(a.useState)([]),s=Object(m.a)(c,2),u=s[0],g=s[1],v=Object(i.useToasts)().addToast,y=Object(a.useState)({}),_=Object(m.a)(y,2),S=_[0],L=_[1],k=Object(a.useState)([]),C=Object(m.a)(k,2),E=C[0],I=C[1],T=Object(a.useState)(""),D=Object(m.a)(T,2),F=D[0],P=D[1],R=Object(a.useState)(""),W=Object(m.a)(R,2),M=W[0],q=W[1],X=Object(a.useState)(),ee=Object(m.a)(X,2),te=(ee[0],ee[1],Object(a.useRef)(null));Object(a.useEffect)((function(){return te.current=Object(K.io)("/"),te.current.on("user-joined",(function(t){var n=t.allUsers.filter((function(t){return t.email!==e.email}));console.log(t.joinedUser),t.joinedUser&&t.joinedUser.email!==e.email?v("".concat(t.joinedUser.name," is active"),{appearance:"info",autoDismiss:!0}):t.leavingUser&&t.leavingUser.email!==e.email&&(v("".concat(t.leavingUser.name," has left"),{appearance:"info",autoDismiss:!0}),L({})),g(n)})),te.current.on("room-user-details",(function(e){L(e)})),te.current.on("chat-message",(function(e){I((function(t){return[].concat(Object(d.a)(t),[e])}))})),te.current.emit("user-login",e),function(){te.current.off("user-joined",(function(e){})),te.current.off("room-user-details",(function(e){})),te.current.off("chat-message",(function(e){}))}}),[v,e,M]);return Object(A.jsxs)("div",{children:[Object(A.jsx)(G.a,{bg:"dark",expand:"lg",children:Object(A.jsxs)(b.a,{children:[Object(A.jsx)(o.b,{to:"/",children:Object(A.jsx)(G.a.Brand,{className:"text-white",children:"Chat Application"})}),Object(A.jsx)(G.a.Toggle,{"aria-controls":"basic-navbar-nav"}),Object(A.jsx)(G.a.Collapse,{id:"basic-navbar-nav",children:Object(A.jsxs)(B.a,{className:"ms-auto",children:[Object(A.jsx)(B.a.Link,{className:"text-white",children:Object(A.jsx)(o.c,{to:"/",children:"Home"})}),Object(A.jsx)(B.a.Link,{className:"text-white",children:e.name}),Object(A.jsx)(B.a.Link,{className:"text-white",children:e.email}),Object(A.jsx)(N.a,{className:"fs-7",onClick:function(){t(function(){var e=Object(h.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t({type:U});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),te.current.disconnect(),n.push("/")},children:Object(A.jsx)(Z.a,{className:"text-white"})})]})})]})}),Object(A.jsx)(b.a,{fluid:"lg",children:Object(A.jsxs)(p.a,{children:[Object(A.jsxs)(f.a,{md:3,style:{height:"calc(100vh - 72px)",backgroundColor:"#1c2834"},children:[Object(A.jsx)("div",{className:"search__bar",children:Object(A.jsxs)(J.a,{className:"py-3",children:[Object(A.jsx)(J.a.Text,{id:"search",className:"bg-white border-end-0",children:Object(A.jsx)(Q.a,{})}),Object(A.jsx)(H.a,{className:"border-start-0",placeholder:"Username","aria-label":"Username","aria-describedby":"search",value:M,onChange:function(e){return q(e.target.value)},type:"text"})]})}),u&&u.map((function(e){return Object(A.jsxs)(Y.a,{body:!0,className:e.isActive?"bg-success p-2 d-flex align-items-center mb-3":"bg-dark p-2 d-flex align-items-center mb-3",style:{cursor:"pointer"},onClick:function(){var t;t=e.email,L(u.filter((function(e){return e.email===t}))[0])},children:[Object(A.jsx)($.a,{badgeContent:e.isActive?E.filter((function(t){return t.from===e.email})).length:0,color:"primary",children:Object(A.jsx)(w.a,{alt:e.name,src:e.photo})}),Object(A.jsxs)("div",{className:"ps-3 ",children:[Object(A.jsx)("h5",{className:"text-white my-0",children:e.name}),Object(A.jsx)("p",{className:"text-white my-0",children:e.isActive?"Active Now":"Left ".concat(z()().fromNow(e.updatedAt))})]})]},e.email)}))]}),Object(A.jsx)(f.a,{md:9,className:"bg-primary",children:Object(A.jsx)("main",{className:"position-relative h-100",children:S.name?Object(A.jsxs)(A.Fragment,{children:[Object(A.jsxs)("section",{className:"message__header d-flex align-items-center py-4 px-2 border-bottom",id:"user__head",children:[Object(A.jsx)(w.a,{alt:S.name,src:S.photo,style:{height:50,width:50}}),Object(A.jsxs)("div",{className:"ps-3",children:[Object(A.jsx)("h4",{className:"text-white my-0",children:S.name}),Object(A.jsx)("p",{className:"text-white my-0",children:S.isActive?"Active now":"Left ".concat(z()().fromNow(S.updatedAt))})]})]}),Object(A.jsx)(V.a,{className:"message__body overflow-auto position-relative",children:E&&E.map((function(t){return e.email!==t.from&&S.email===t.from&&e.email===t.to?Object(A.jsxs)("div",{className:"d-flex my-3 chat__buddy",style:{marginRight:"20%"},children:[Object(A.jsx)(w.a,{alt:t.name,src:t.photo}),Object(A.jsxs)("div",{children:[Object(A.jsx)(Y.a,{body:!0,className:"chat__card chat__person ms-3 p-2",style:{width:"100%"},children:t.message}),Object(A.jsx)("p",{className:"text-white ms-3",children:z()().fromNow(t.sendAt)})]})]},t.id):e.email===t.from&&S.email===t.to?Object(A.jsxs)("div",{className:"d-flex flex-column justify-content-end align-items-end my-3",style:{marginLeft:"20%"},children:[Object(A.jsxs)("div",{className:"d-flex my__chat text-right justify-content-end",children:[Object(A.jsx)(Y.a,{body:!0,className:"chat__card chat__person me-3 p-2",style:{width:"100%"},children:t.message}),Object(A.jsx)(w.a,{alt:t.name,src:t.photo})]}),Object(A.jsx)("p",{className:"text-white me-5",children:z()().fromNow(t.sendAt)})]},t.id):(S.email,t.to,null)}))}),Object(A.jsx)("section",{className:"input__area position-absolute bottom-0 start-0 end-0",id:"text__area",children:Object(A.jsxs)("form",{onSubmit:function(t){t.preventDefault();var n={user:e._id,from:e.email,file:"",to:S.email,message:F,sendAt:Date.now()};F?(P(""),te.current.emit("message",n),I((function(e){return[].concat(Object(d.a)(e),[n])}))):v("Please Write something",{appearance:"info",autoDismiss:!0})},className:"d-flex justify-content-center align-items-start",children:[Object(A.jsx)(O.a.Group,{className:"mb-3 w-100",controlId:"exampleForm.ControlTextarea1",children:Object(A.jsx)(O.a.Control,{value:F,onChange:function(e){return P(e.target.value)},as:"textarea",rows:3})}),Object(A.jsx)(x.a,{variant:"outline-secondary",className:"ms-2",type:"submit",children:"Send"})]})})]}):Object(A.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)"},children:Object(A.jsx)("h4",{className:"text-white",children:"Please Select a conversation"})})})})]})})]})},te=function(){return Object(A.jsxs)(l.d,{children:[Object(A.jsx)(l.b,{path:"/login",component:W}),Object(A.jsx)(P,{path:"/chat",children:Object(A.jsx)(ee,{})}),Object(A.jsx)(l.b,{path:"/not-found",component:T}),Object(A.jsx)(l.b,{exact:!0,path:"/",component:I}),Object(A.jsx)(l.a,{to:"/not-found"})]})},ne=(n(491),n(492),n(493),function(){return Object(A.jsx)(o.a,{children:Object(A.jsx)(l.b,{path:"/",component:te})})}),ae=n(87),ce=n(270),se=n(271),re=Object(ae.combineReducers)({userLogin:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case S:return{loading:!0};case L:case C:return{loading:!1,user:t.payload};case E:case k:return{loading:!1,error:t.payload};case U:return{};default:return e}}}),ie=localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):{},oe={userLogin:{user:ie.isLoggedIn?ie:{isLoggedIn:!1}}},le=[se.a],ue=Object(ae.createStore)(re,oe,Object(ce.composeWithDevTools)(ae.applyMiddleware.apply(void 0,le))),je=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,523)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,s=t.getLCP,r=t.getTTFB;n(e),a(e),c(e),s(e),r(e)}))},de=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function he(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}s.a.render(Object(A.jsx)(r.a,{store:ue,children:Object(A.jsx)(i.ToastProvider,{children:Object(A.jsx)(ne,{})})}),document.getElementById("root")),je(),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");de?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):he(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):he(t,e)}))}}()}},[[494,1,2]]]);
//# sourceMappingURL=main.a7fc2c0e.chunk.js.map